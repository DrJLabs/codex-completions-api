PROXY_API_KEY=your-dev-key

# Optional: environment label used for /v1/models advertising.
# - dev: advertises `codev-5*`
# - (unset): advertises `codex-5*`
# PROXY_ENV=dev

# Optional overrides for local dev
# PORT=18000
# PROXY_HOST=127.0.0.1 # set for loopback-only binding
# PROXY_TRUST_PROXY=loopback # "false" to disable; loopback recommended when Traefik runs on host
# CODEX_HOME=.codev

# Toggle between app-server (default) and legacy proto backends. Set to false only for
# compatibility testing or emergency fallback; production/dev defaults should stay true.
PROXY_USE_APP_SERVER=true
# CODEX_BIN=codex
# CODEX_MODEL=gpt-5.2
# PROXY_TITLE_SUMMARY_EXEC_MODEL=gpt-5.2
# PROXY_TITLE_SUMMARY_EXEC_REASONING_EFFORT=low
# CODEX_FORCE_PROVIDER=

# Sandbox and workdir (defaults are safe; override only when needed).
# PROXY_SANDBOX_MODE=read-only
# PROXY_CODEX_WORKDIR=/tmp/codex-work
# Gate the /v1/responses endpoint. Default true; set false to hide responses during
# staged rollouts or when environments intentionally expose chat-only.
# PROXY_ENABLE_RESPONSES=false

# Optional: gate /v1/models behind the bearer token (default false).
# PROXY_PROTECT_MODELS=true

# Optional: allow /v1/usage unauthenticated (default false; keep off in prod).
# PROXY_USAGE_ALLOW_UNAUTH=true
# Optional OTLP tracing (disabled by default)
# PROXY_ENABLE_OTEL=true
# PROXY_OTEL_EXPORTER_URL=http://localhost:4318/v1/traces
# PROXY_OTEL_SERVICE_NAME=codex-app-server-proxy
# Worker supervisor tuning (ms). Defaults align with Story 1.3 rollout guidance.
# WORKER_BACKOFF_INITIAL_MS=500
# WORKER_BACKOFF_MAX_MS=5000
# WORKER_RESTART_MAX=25
# WORKER_STARTUP_TIMEOUT_MS=8000
# WORKER_SHUTDOWN_GRACE_MS=5000
# WORKER_MAX_CONCURRENCY=4
# WORKER_REQUEST_TIMEOUT_MS=120000
# WORKER_HANDSHAKE_TIMEOUT_MS=15000
#
# Production note:
#  - Provision `.codex-api/` on the host with Codex config and secrets;
#    docker-compose mounts it at /app/.codex-api and it MUST be writable.
# Responses host for standard OpenAI clients
# RESPONSES_DOMAIN=codex-responses-api.onemainarmy.com

#
# Optional tool-streaming guards (safe defaults keep them disabled)
#
# When true, the proxy will end the SSE stream shortly after emitting complete
# <use_tool>...</use_tool> blocks to avoid confusing clients that expect the
# assistant to stop after tools (e.g., Obsidian Copilot). Default: disabled.
# PROXY_STOP_AFTER_TOOLS=true

# Mode can be "first" (cut immediately after the first tool block) or
# "burst" (default) which waits a short grace period so multiple back-to-back
# tool blocks are delivered together before cutting.
# PROXY_STOP_AFTER_TOOLS_MODE=burst

# Grace window (ms) used when MODE=burst. Default 300.
# PROXY_STOP_AFTER_TOOLS_GRACE_MS=300

# Optional cap on how many tool blocks to allow before cutting (0 = unlimited).
# PROXY_TOOL_BLOCK_MAX=0

# Suppress assistant narrative after the last tool block while still allowing
# the backend to complete normally. Optional dedupe and delimiter helpers can
# clean up repeated blocks or separate them with blank lines.
# PROXY_SUPPRESS_TAIL_AFTER_TOOLS=true
# PROXY_TOOL_BLOCK_DEDUP=true
# PROXY_TOOL_BLOCK_DELIMITER=true
# PROXY_ENABLE_PARALLEL_TOOL_CALLS=true
# PROXY_LOG_CORS_ORIGIN=true

# Metrics (Prometheus)
# PROXY_ENABLE_METRICS=true
# PROXY_METRICS_ALLOW_LOOPBACK=true
# PROXY_METRICS_TOKEN=your-metrics-token

# Output envelope control: obsidian-xml (default) emits literal <use_tool> content while
# openai-json mirrors OpenAI's tool_call response shape (content:null + tool_calls[]).
# Override per request with the x-proxy-output-mode header (same values).
# PROXY_OUTPUT_MODE=obsidian-xml

# `/v1/responses` output mode default. When unset, `/v1/responses` forces openai-json so
# tool intent is delivered via typed tool events instead of being duplicated inside
# response.output_text.delta as literal <use_tool> text. Client header still wins.
# PROXY_RESPONSES_OUTPUT_MODE=openai-json
# `/v1/responses` default max_tokens fallback when no max token field is supplied.
# PROXY_RESPONSES_DEFAULT_MAX_TOKENS=0

# Drop Codex rollout telemetry (e.g., rollout_path, session_id) from non-stream
# and streaming responses while logging the raw values internally. Defaults to
# false for staged rollout. Enable when ready to sanitize metadata for clients.
# PROXY_SANITIZE_METADATA=true
