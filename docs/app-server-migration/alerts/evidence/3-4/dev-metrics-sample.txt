Command (local module simulation):
node --input-type=module - <<'NODE'
import { recordToolBufferEvent, renderMetrics, observeHttpRequest, setWorkerMetrics } from './src/services/metrics/index.js';
observeHttpRequest({ route: '/v1/chat/completions', method: 'POST', statusCode: 500, model: 'codex-5', durationMs: 1800 });
observeHttpRequest({ route: '/v1/chat/completions', method: 'POST', statusCode: 200, model: 'codex-5', durationMs: 900 });
setWorkerMetrics({ restarts_total: 4, ready: true, next_restart_delay_ms: 0 });
recordToolBufferEvent('abort', { output_mode: 'obsidian-xml', reason: 'test-anomaly' });
const metrics = await renderMetrics();
console.log(metrics);
NODE

Excerpt:
- codex_http_requests_total{route="/v1/chat/completions",method="POST",status_family="5xx",model="codex-5"} 1
- codex_http_latency_ms_bucket{...status_family="5xx"...} sum=1800 count=1
- codex_worker_restarts_total 4
- codex_tool_buffer_anomaly 1 (auto-resets after 2m)
- codex_tool_buffer_aborted_total{output_mode="obsidian-xml",reason="test-anomaly"} 1
