<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="640" viewBox="0 0 1000 640" font-family="Inter,Segoe UI,Arial,Helvetica,sans-serif">
  <defs>
    <style>
      .box { fill:#fff; stroke:#2c3e50; stroke-width:2; rx:8; ry:8; }
      .title { font-weight:600; fill:#2c3e50; }
      .small { fill:#34495e; font-size:12px; }
      .arrow { stroke:#2c3e50; stroke-width:2; marker-end:url(#arrowhead); fill:none; }
      .muted { fill:#94a3b8; font-size:12px; }
      .route { fill:#0ea5e9; font-weight:600; }
      .ok { fill:#22c55e; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
    </marker>
  </defs>

  <rect x="0" y="0" width="1000" height="640" fill="#f8fafc" />

  <!-- Client -->
  <rect class="box" x="40" y="50" width="200" height="80" />
  <text class="title" x="140" y="82" text-anchor="middle">Client (IDE/SDK)</text>
  <text class="small" x="140" y="104" text-anchor="middle">/v1/models, /v1/chat/completions</text>

  <!-- Cloudflare -->
  <rect class="box" x="280" y="50" width="220" height="80" />
  <text class="title" x="390" y="82" text-anchor="middle">Cloudflare</text>
  <text class="small" x="390" y="104" text-anchor="middle">TLS, CDN, WAF</text>

  <!-- Traefik host -->
  <rect class="box" x="540" y="30" width="380" height="120" />
  <text class="title" x="730" y="62" text-anchor="middle">Traefik (host service)</text>
  <text class="small" x="730" y="84" text-anchor="middle">entrypoint: websecure :443</text>
  <text class="small" x="730" y="104" text-anchor="middle">routers: codex-api, codex-preflight, codex-models, codex-health</text>

  <!-- Arrows across edge -->
  <path class="arrow" d="M240,90 L280,90" />
  <path class="arrow" d="M500,90 L540,90" />

  <!-- ForwardAuth and chain -->
  <rect class="box" x="540" y="190" width="220" height="90" />
  <text class="title" x="650" y="222" text-anchor="middle">ForwardAuth</text>
  <text class="small" x="650" y="244" text-anchor="middle">http://127.0.0.1:18080/verify</text>

  <rect class="box" x="800" y="180" width="120" height="110" />
  <text class="title" x="860" y="212" text-anchor="middle">RateLimit</text>
  <text class="muted" x="860" y="234" text-anchor="middle">codex-ratelimit</text>
  <text class="muted" x="860" y="250" text-anchor="middle">avg/burst</text>

  <rect class="box" x="540" y="320" width="380" height="120" />
  <text class="title" x="730" y="352" text-anchor="middle">App (codex-completions-api)</text>
  <text class="small" x="730" y="374" text-anchor="middle">service: codex-api â†’ 11435</text>
  <text class="small" x="730" y="394" text-anchor="middle">/healthz (no auth), /v1/models (no auth)</text>
  <text class="small" x="730" y="414" text-anchor="middle">/v1/chat/completions (auth)</text>

  <rect class="box" x="560" y="480" width="340" height="100" />
  <text class="title" x="730" y="512" text-anchor="middle">Codex CLI (proto)</text>
  <text class="small" x="730" y="534" text-anchor="middle">--config model_reasoning_effort &middot; CODEX_HOME</text>
  <text class="small" x="730" y="552" text-anchor="middle">Emits JSONL: agent_message(_delta), token_count, task_complete</text>

  <!-- Flow arrows down the stack and back -->
  <path class="arrow" d="M730,150 L730,190" />
  <path class="arrow" d="M760,280 L760,320" />
  <path class="arrow" d="M730,440 L730,480" />

  <!-- SSE return path annotations -->
  <path class="arrow" d="M560,520 L240,520 L240,130" />
  <text class="route" x="260" y="515">SSE: role first, then deltas, [DONE]</text>

  <!-- Router special cases -->
  <text class="ok" x="730" y="240" text-anchor="middle">/v1/models, /healthz bypass ForwardAuth</text>

  <!-- Legend -->
  <rect class="box" x="40" y="560" width="920" height="60" />
  <text class="title" x="80" y="585">Legend:</text>
  <text class="small" x="160" y="585">Solid arrows indicate request path; bottom arrow is SSE response stream.</text>

</svg>

