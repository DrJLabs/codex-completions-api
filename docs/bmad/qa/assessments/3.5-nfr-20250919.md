---
title: NFR Assessment — Story 3.5 (Golden Transcripts & Contract Checks)
story: docs/bmad/stories/3.5.golden-transcripts-contract-checks.md
date: 2025-09-19
owner: QA (Quinn)
labels: [qa, nfr, parity, snapshots]
---

## Scope & Summary

Story 3.5 adds deterministic golden transcript capture, Vitest/Playwright contract tests, and documentation updates. Assessment focuses on performance impact, reliability of the recorder, observability of failures, and security considerations around stored transcripts.

## Quality Attributes

- Performance: LOW IMPACT — Transcript generation runs outside the hot path (`npm run transcripts:generate`). Integration/Playwright contract checks add ~3s to `npm run verify:all`, well within pipeline budget; CI baseline updated to monitor runtime.
- Reliability: IMPROVED — Automated diffs catch behavioral drift in both non-stream and streaming flows. `ensureTranscripts()` regenerates fixtures on demand, preventing flaky tests when artifacts are missing.
- Security: ACCEPTABLE — Transcripts sanitize dynamic IDs/timestamps and only contain deterministic fake Codex responses (no secrets). Documentation reminds teams to keep real prompts out of fixtures and redaction remains in place.
- Observability: ENHANCED — Contract failures produce exact JSON diffs; Playwright keeps traces for analysis. Issue follow-up introduces Keploy integration for richer telemetry.
- Maintainability: IMPROVED — Shared utilities (`tests/shared/transcript-utils.js`) centralize sanitization and parsing logic. Script and docs describe refresh workflow, reducing tribal knowledge.

## Risks & Mitigations

- Risk: Transcript regeneration forgotten after shim updates.
  - Mitigation: `ensureTranscripts()` auto-runs generator when files missing; docs instruct running `npm run transcripts:generate`.
- Risk: CI runtime creep as contract suites expand.
  - Mitigation: Tech stack doc instructs monitoring `npm run verify:all` duration; pipeline threshold can alert on >10% increase.
- Risk: Future provider transcripts might include sensitive data.
  - Mitigation: Keep fake Codex fixtures deterministic; upcoming Keploy integration will include sanitization pipeline.

## Validation

- Automation: `npm run test:unit`, `npm run test:integration`, `npx playwright test tests/e2e/chat-contract.spec.ts` — all green with new suites.
- Documentation: `docs/openai-chat-completions-parity.md` and issue follow-up updated; tech stack doc notes CI version requirements; new issue tracks Keploy rollout.

## Decision

NFR Status: PASS — No additional non-functional work required prior to merge. Monitor transcript generation time once Keploy recording lands.
