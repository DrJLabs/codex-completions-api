---
title: Requirements Traceability — Story 1.5 (Phase 4: Codex Runner & SSE Utilities)
story: docs/bmad/stories/1.5.phase-4-codex-runner-and-sse-utils.md
epic: docs/bmad/stories/epic-server-modularization-refactor.md
date: 2025-09-12
author: Quinn (Test Architect)
references:
  - test_design: docs/bmad/qa/assessments/1.5-test-design-20250912.md
  - risk_profile: docs/bmad/qa/assessments/1.5-risk-20250912.md
---

# Requirements Traceability Matrix

## Coverage Summary

- Total Requirements (ACs): 6
- Fully Covered: 5 (83%)
- Partially Covered: 1 (17%) — AC5 observability parity (validated indirectly)
- Not Covered: 0 (0%)

## Requirement Mappings

### AC1: Services created (codex-runner, sse)

Coverage: FULL

- Unit: 1.5-UNIT-001 — codex-runner args/env
  - Given config with model/provider/dirs
  - When building/spawning process
  - Then child has correct argv, env, cwd
- Unit: 1.5-UNIT-002 — timeouts/kill-on-disconnect
  - Given running child process
  - When timeout/aborted
  - Then child terminates as configured
- Unit: 1.5-UNIT-003 — sse headers/DONE
  - Given response initialized
  - When stream starts/finishes
  - Then correct headers and `[DONE]`

### AC2: Behavior unchanged (stream/non‑stream)

Coverage: FULL

- Integration: 1.5-INT-001 — non‑stream envelope/headers/usage match golden
  - Given chat POST stream=false
  - When aggregating child output
  - Then OpenAI‑compatible JSON + usage
- Integration: 1.5-INT-002 — role‑first, stable id, `[DONE]`
  - Given chat POST stream=true
  - When streaming deltas
  - Then first delta role=assistant; ends `[DONE]`

### AC3: Config respected (keepalive, tools, timeouts)

Coverage: FULL

- Unit: 1.5-UNIT-004 — keepalive disable heuristics
  - Given UA/header/query toggles
  - When computing interval
  - Then keepalives disabled appropriately
- Unit: 1.5-UNIT-005 — tool-block cut/tail flags
  - Given tool block content
  - When flags enabled
  - Then cut/tail behavior matches prior

### AC4: Handlers updated to use services w/ no API/header changes

Coverage: FULL

- Integration: 1.5-INT-001/002 (parity proves unchanged outward behavior)
  - Given existing route callers
  - Then responses and headers identical to golden

### AC5: Observability parity (access logs behavior)

Coverage: PARTIAL (indirect)

- Evidence: No changes to `src/middleware/access-log.js`; integration tests validate headers and status logging occurs
- Gap: No specific assertion on structured log fields values (non-blocking for this story)

### AC6: Tests unchanged pass (integration + E2E)

Coverage: FULL

- E2E: 1.5-E2E-001 (non‑stream end‑to‑end)
- E2E: 1.5-E2E-002 (stream end‑to‑end)

## Critical Gaps

- None. Observability parity could add explicit assertions later; not required for story acceptance.

## Gate YAML Block

```yaml
trace:
  totals:
    requirements: 6
    full: 5
    partial: 1
    none: 0
  planning_ref: "docs/bmad/qa/assessments/1.5-test-design-20250912.md"
  uncovered: []
  notes: "See docs/bmad/qa/assessments/1.5-trace-20250912.md"
```

## Story Hook

Trace matrix: docs/bmad/qa/assessments/1.5-trace-20250912.md
