---
title: Requirements Traceability Matrix — Story 2.6 (Usage Latency Placeholders)
story: docs/bmad/stories/2.6.phase-h-usage-latency-placeholders.md
epic: docs/bmad/stories/epic-openai-chat-completions-parity.md
date: 2025-09-14
owner: QA (Quinn)
---

## Scope

Map each acceptance criterion (AC) for Story 2.6 to tests and docs ensuring placeholder latency fields are added only to the streaming final usage chunk when requested, with no changes to non‑stream.

## Matrix

- AC‑1 Placeholders in final streaming usage chunk when `include_usage:true`
  - Tests:
    - tests/sse-usage-placeholders.spec.js — asserts `time_to_first_token:null` and `throughput_after_first_token:null` present only on usage chunk.
  - Docs: docs/openai-chat-completions-parity.md (Streaming Contract — usage placeholders note)
  - Status: COVERED

- AC‑2 Non‑stream unchanged (no placeholders)
  - Tests:
    - tests/integration/nonstream.no-latency-placeholders.int.test.js — asserts absence of placeholder keys in non‑stream `usage`.
  - Status: COVERED

- AC‑3 SSE ordering preserved
  - Tests:
    - tests/sse-finish-reason-order.spec.js — finalizer precedes usage; `[DONE]` last.
  - Status: COVERED

- AC‑4 Backward compatibility when usage not requested
  - Tests:
    - tests/sse-usage-negative.spec.js — no usage chunk when `include_usage` omitted.
  - Status: COVERED

- AC‑5 Docs updated
  - Artifact: docs/openai-chat-completions-parity.md updated 2025‑09‑14 with placeholder details.
  - Status: COVERED

## Given‑When‑Then Snippets

- Given `stream:true` and `stream_options.include_usage:true`, when streaming completes, then the final usage chunk includes `time_to_first_token:null` and `throughput_after_first_token:null`.
- Given `stream:true` without `include_usage`, when streaming completes, then no usage chunk is emitted.
- Given `stream:false`, when posting to `/v1/chat/completions`, then response `usage` includes only `{prompt_tokens, completion_tokens, total_tokens}`.

## Coverage Summary

- Coverage: FULL
- Notes: One unrelated integration test flake in 2.x suite documented in docs/bmad/issues/2025-09-14-nonstream-length-flake.md.
