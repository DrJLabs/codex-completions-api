---
title: Requirements Trace — Story 3.1 (Dev Edge Non‑Stream Timeout)
story: docs/bmad/stories/3.1.dev-edge-nonstream-timeout.md
date: 2025-09-15
reviewer: Quinn (Test Architect)
labels: [qa, trace]
---

# Requirements Trace: Story 3.1

## AC → Evidence Mapping

- AC1: Dev edge non‑stream success (200 JSON, within timeout)
  - Evidence: `npm run smoke:dev-edge -- --headers` (2025‑09‑15 07:11 UTC)
  - Result: HTTP 200; `object:"chat.completion"`; finish_reason:"length" (dev‑guard early finalize)
  - Headers: edge CORS present; `cf-cache-status: DYNAMIC`; `server: cloudflare`.

- AC2: Parity & regression guard
  - Non‑stream shape: Valid JSON; includes `id/object/created/model/choices[0]/usage`.
  - Streaming sanity: Prior run showed role delta, finish_reason chunk, `[DONE]`.
  - Local integration suite: green (shape, model consistency, errors).

- AC3: Root cause documented
  - RCA: CF 524 on dev due to >100s with no bytes on non‑stream; streaming OK due to early bytes.
  - Fix: Dev early‑finalize at 60s (finish_reason:"length"); switch to minimal model; runbook added.

- AC4: Verification
  - Local `npm run verify:all`: green.
  - Dev edge smoke: 200 for non‑stream; streaming remains 200.

## Gaps / Notes

- Content for non‑stream in dev may include upstream error logs when provider rejects minimal model; still conforms to envelope.
- Cloudflare cache ruleset matcher fixed for `/v1/chat/completions` (dev).
