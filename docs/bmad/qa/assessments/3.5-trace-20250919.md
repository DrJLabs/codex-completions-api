---
title: Requirements Traceability Matrix — Story 3.5 (Golden Transcripts & Contract Checks)
story: docs/bmad/stories/3.5.golden-transcripts-contract-checks.md
epic: docs/bmad/stories/epic-stability-ci-hardening-sep-2025.md
date: 2025-09-19
owner: QA (Quinn)
---

## Scope

Verify that each acceptance criterion for Story 3.5 is exercised by automated coverage or documented evidence, ensuring golden transcript capture and contract tests guard non-stream and streaming parity.

## Matrix

- AC‑1 Golden transcript corpus
  - Tests / Artifacts:
    - `scripts/generate-chat-transcripts.mjs` — refreshed fixtures (`nonstream-minimal.json`, `nonstream-truncation.json`, `streaming-usage.json`).
    - Integration fallback: `tests/shared/transcript-utils.ensureTranscripts()` auto-regenerates when corpus missing.
  - Status: COVERED

- AC‑2 Non-stream contract validation
  - Tests:
    - `tests/integration/chat.contract.nonstream.int.test.js` — diffs live non-stream responses (normal + truncation) against golden fixtures.
    - Playwright: `tests/e2e/chat-contract.spec.ts` (non-stream scenario).
  - Status: COVERED

- AC‑3 Streaming contract validation
  - Tests:
    - `tests/integration/chat.contract.streaming.int.test.js` — parses SSE stream, sanitizes, and compares to `streaming-usage.json` sequence.
    - Playwright: `tests/e2e/chat-contract.spec.ts` (streaming scenario with usage chunk).
  - Status: COVERED

- AC‑4 CI integration & docs
  - Artifacts:
    - `package.json` script `transcripts:generate` + Tech Stack doc CI baseline update.
    - `docs/openai-chat-completions-parity.md` new section describing corpus + maintenance.
    - Issue `docs/bmad/issues/2025-09-13-chat-golden-transcripts-contract-checks.md` updated with implementation notes.
  - Status: COVERED

## Given‑When‑Then Highlights

- Given the transcript corpus is present, when integration tests run, then non-stream responses sanitize dynamic IDs/timestamps and match golden JSON exactly.
- Given `stream_options.include_usage:true`, when streaming tests replay transcripts, then finish_reason precedes usage chunk and `[DONE]` sentinel, ensuring usage emission order.
- Given Playwright CI executes with trace capture, when streaming regressions occur, then trace artifacts + transcript diff pinpoint the chunk order change.

## Coverage Summary

- Coverage: FULL
- Notes: Keploy adoption (issue 2025-09-19) will further automate recording; ensure transcripts are refreshed whenever fake Codex shims change.
