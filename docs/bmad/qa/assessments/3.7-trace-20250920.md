---
title: Requirements Traceability Matrix — Story 3.7 (Keploy CLI Rollout & Enablement)
story: docs/bmad/stories/3.7.keploy-cli-rollout.md
epic: docs/bmad/stories/epic-stability-ci-hardening-sep-2025.md
date: 2025-09-20
owner: QA (Quinn)
---

## Scope

Map the four acceptance criteria for Story 3.7 to the evidence collected during implementation so we can confirm install automation, documentation, and CI dry-run readiness for the Keploy rollout.

## Matrix

- **AC1 — Keploy 3.x installation scripted for CI/local dev with port/loopback validation**
  - Evidence:
    - `scripts/setup-keploy-cli.sh` enforces `127.0.0.1` host binding, checks ports 16789/16790/26789 before running the official installer, and prints the resolved CLI version.
    - `.github/workflows/ci.yml` caches the CLI layer and reuses the helper when `KEPLOY_ENABLED=true`.
  - Tests / Scenarios:
    - 3.7-INT-001 (CI workflow install smoke) — pending execution once the flag is enabled on runners.
  - Status: **PARTIAL** — automation exists but has not yet been exercised on runners because `KEPLOY_ENABLED` remains false.

- **AC2 — Document environment variables and developer guidance**
  - Evidence:
    - `.env.example` / `.env.dev` now list `KEPLOY_MODE`, `KEPLOY_APP_PORT`, port overrides, and loopback binding expectations.
    - `docs/bmad/architecture/tech-stack.md` and `docs/openai-chat-completions-parity.md` detail install steps, caching strategy, and dry-run workflow.
  - Tests / Scenarios:
    - 3.7-INT-002 / 3.7-UNIT-003 (doc lint & content checks) — covered by `npm run verify:all` (Prettier + eslint) ensuring formatting consistency.
  - Status: **FULL**.

- **AC3 — CI dry-run stage executes `keploy test` with artefacts and respects budgets**
  - Evidence:
    - New `keploy-dry-run` job in `.github/workflows/ci.yml` runs after `build-and-test`, uploading CLI logs and replay metrics.
    - Job exports metrics file (`replay_duration_seconds`) for budget tracking.
  - Tests / Scenarios:
    - 3.7-INT-003 / 3.7-INT-004 (dry-run rehearsal + performance guard) — awaiting activation when `KEPLOY_ENABLED=true`.
  - Status: **PARTIAL** — infrastructure present, execution pending rollout toggle and validation run.

- **AC4 — Documentation/runbook captures troubleshooting, verification steps, and enablement decision path**
  - Evidence:
    - `docs/bmad/architecture/tech-stack.md` includes install helper usage, caching, and env contract.
    - `docs/openai-chat-completions-parity.md` describes Keploy dry-run expectations.
    - Issue `docs/bmad/issues/2025-09-20-keploy-install-config.md` updated with progress and next steps.
  - Status: **FULL**.

## Given‑When‑Then Highlights

- **Given** a developer runs `./scripts/setup-keploy-cli.sh`, **when** the script validates ports and downloads the installer, **then** the Keploy CLI is installed on the loopback-only configuration and prints its version for audit.
- **Given** CI executes with `KEPLOY_ENABLED=true`, **when** `keploy-dry-run` job runs, **then** replay logs and duration metrics are uploaded as workflow artefacts for budget monitoring.
- **Given** a developer enables Keploy locally, **when** `.env.dev` is sourced, **then** the proxy binds to `127.0.0.1` ports and can be toggled with `KEPLOY_MODE=test` without exposing ports publicly.

## Coverage Summary

- Total Requirements: 4
- Fully Covered: 2 (50%)
- Partially Covered: 2 (50%)
- Not Covered: 0 (0%)

### Coverage Gaps

1. **AC1** — Need a recorded run (CI or local) demonstrating the helper installing Keploy successfully on runners/hosts; capture logs once rollout toggle is flipped.
2. **AC3** — Dry-run job present but has not executed yet; require evidence of `keploy test` artefacts and runtime metrics before marking complete.

## Recommendations

- Enable a canary workflow with `KEPLOY_ENABLED=true` to produce artefacts for AC1/AC3 and close the remaining gaps.
- Retain runtime metric logging to establish acceptable thresholds once replay data is captured.

Trace matrix: docs/bmad/qa/assessments/3.7-trace-20250920.md
