---
title: Requirements Traceability Matrix — Story 3.7 (Keploy CLI Rollout & Enablement)
story: docs/bmad/stories/3.7.keploy-cli-rollout.md
epic: docs/bmad/stories/epic-stability-ci-hardening-sep-2025.md
date: 2025-09-21
owner: QA (Quinn)
---

## Scope

Map the four acceptance criteria for Story 3.7 to the evidence collected during implementation so we can confirm install automation, documentation, and CI dry-run readiness for the Keploy rollout.

## Matrix

- **AC1 — Keploy 3.x installation scripted for CI/local dev with port/loopback validation**
  - Evidence:
    - `scripts/setup-keploy-cli.sh` enforces `127.0.0.1` host binding, checks ports 16789/16790/26789 before running the official installer, and prints the resolved CLI version.
    - `.github/workflows/ci.yml` caches the CLI layer and reuses the helper when `KEPLOY_ENABLED=true`; the repository GitHub environment now sets the variable to `true` so the helper executes on every push.
    - GitHub Actions run `keploy-dry-run` (2025-09-21, commit `c409b7f`) installed the CLI on a hosted runner and emitted `artifacts/keploy/version.txt` (`Keploy 2.10.25`).
  - Tests / Scenarios:
    - 3.7-INT-001 (CI workflow install smoke) — satisfied by the 2025-09-21 dry-run execution.
  - Status: **FULL**.

- **AC2 — Document environment variables and developer guidance**
  - Evidence:
    - `.env.example` / `.env.dev` now list `KEPLOY_MODE`, `KEPLOY_APP_PORT`, port overrides, and loopback binding expectations.
    - `docs/bmad/architecture/tech-stack.md` and `docs/openai-chat-completions-parity.md` detail install steps, caching strategy, and dry-run workflow.
  - Tests / Scenarios:
    - 3.7-INT-002 / 3.7-UNIT-003 (doc lint & content checks) — covered by `npm run verify:all` (Prettier + eslint) ensuring formatting consistency.
  - Status: **FULL**.

- **AC3 — CI dry-run stage executes `keploy test` with artefacts and respects budgets**
  - Evidence:
    - `keploy-dry-run` job in `.github/workflows/ci.yml` now runs automatically with `KEPLOY_ENABLED=true`, uploading CLI logs and replay metrics.
    - GitHub Actions artefacts from 2025-09-21 (`keploy/test.log`, `metrics.txt`, `version.txt`) confirm a successful replay with `replay_duration_seconds=37`.
  - Tests / Scenarios:
    - 3.7-INT-003 / 3.7-INT-004 satisfied by the 2025-09-21 run; performance telemetry captured in metrics file.
  - Status: **FULL**.

- **AC4 — Documentation/runbook captures troubleshooting, verification steps, and enablement decision path**
  - Evidence:
    - `docs/bmad/architecture/tech-stack.md` includes install helper usage, caching, and env contract.
    - `docs/openai-chat-completions-parity.md` describes Keploy dry-run expectations.
    - Issue `docs/bmad/issues/2025-09-20-keploy-install-config.md` updated with progress and next steps.
  - Status: **FULL**.

## Given‑When‑Then Highlights

- **Given** a developer runs `./scripts/setup-keploy-cli.sh`, **when** the script validates ports and downloads the installer, **then** the Keploy CLI is installed on the loopback-only configuration and prints its version for audit.
- **Given** CI executes with `KEPLOY_ENABLED=true`, **when** `keploy-dry-run` job runs, **then** replay logs and duration metrics are uploaded as workflow artefacts for budget monitoring.
- **Given** a developer enables Keploy locally, **when** `.env.dev` is sourced, **then** the proxy binds to `127.0.0.1` ports and can be toggled with `KEPLOY_MODE=test` without exposing ports publicly.

## Coverage Summary

- Total Requirements: 4
- Fully Covered: 4 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Coverage Gaps

None — all acceptance criteria have direct evidence.

## Recommendations

- Continue monitoring replay duration metrics and refresh snapshots as new contract scenarios are added.

Trace matrix: docs/bmad/qa/assessments/3.7-trace-20250920.md
