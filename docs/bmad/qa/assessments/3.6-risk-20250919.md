---
title: Risk Profile — Story 3.6 (Keploy Snapshot CI Integration)
story: docs/bmad/stories/3.6.keploy-snapshot-ci-integration.md
date: 2025-09-19
reviewer: Quinn (Test Architect)
labels: [qa, risk, keploy, ci, snapshots]
---

# Risk Profile: Story 3.6 — Keploy Snapshot CI Integration

Date: 2025-09-19  
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 7
- Critical Risks: 0
- High Risks: 2 (TECH-361, OPS-361)
- Medium Risks: 3
- Low Risks: 2
- Overall Story Risk Score: Medium — success depends on deterministic Keploy proxy behavior and disciplined CI orchestration.

## Risk Summary (Gate YAML)

```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 3
    low: 2
  highest:
    id: TECH-361
    score: 6
    title: Keploy proxy alters streaming or SSE semantics, corrupting golden transcripts during record/replay
  recommendations:
    must_fix:
      - Validate the Keploy proxy against streaming SSE traces before enabling record/test gates in CI.
      - Keep inline recorder fallback healthy and document a rapid rollback plan.
    monitor:
      - Track Keploy CLI version drift and regenerate snapshots when major versions introduce breaking changes.
      - Capture CI metrics for record/test stages to spot flakiness or runtime regressions early.
```

## Risk Register

| Risk ID  | Category      | Description                                                                                                                 | Prob | Impact | Score | Priority |
| -------- | ------------- | --------------------------------------------------------------------------------------------------------------------------- | ---- | ------ | ----- | -------- |
| TECH-361 | Technical     | Keploy proxy alters SSE streaming behavior (chunk order, keepalive cadence) causing contract tests to replay incorrect data | 2    | 3      | 6     | High     |
| OPS-361  | Operational   | CI record/test stages fail across environments due to Keploy daemon requirements or port conflicts                          | 2    | 3      | 6     | High     |
| SEC-361  | Security      | Snapshots capture bearer tokens or secrets because sanitization filters are incomplete                                      | 2    | 2      | 4     | Medium   |
| TOOL-361 | Tooling       | Keploy CLI 3.x releases break compatibility with existing `keploy.yml` or alter report schema without notice                | 2    | 2      | 4     | Medium   |
| TEST-361 | Testing       | Inline fallback and Keploy replay drift apart, causing inconsistent results between local runs and CI                       | 2    | 2      | 4     | Medium   |
| PERF-361 | Performance   | Record/replay stages increase `npm run verify:all` duration beyond pipeline budget                                          | 1    | 2      | 2     | Low      |
| DOC-361  | Documentation | Developers lack guidance for recording new scenarios or diagnosing proxy failures, slowing incident response                | 1    | 2      | 2     | Low      |

## Mitigations & Owners

- TECH-361: Run compatibility smoke (streaming transcript capture + diff) whenever Keploy proxy config changes; enforce parity via automated contract tests. Owner: Dev/QA. citeturn0search0turn0search1turn1search0
- OPS-361: Provision self-contained Keploy service container in CI with explicit health checks and port assignments; document required runner capabilities. Owner: DevOps. citeturn2search0
- SEC-361: Define sanitization rules in `keploy.yml` and add unit tests to assert masking of auth headers and IDs pre-commit. Owner: Dev. citeturn1search0
- TOOL-361: Pin Keploy CLI version via installer script and add dependabot-style alert when upstream releases major versions; capture report schema in regression tests. Owner: QA/DevOps.
- TEST-361: Maintain dual-mode regression tests (inline + Keploy) and gate merges unless both paths pass; publish guidance for toggling `KEPLOY_ENABLED`. Owner: QA.
- PERF-361: Benchmark record/test stage runtimes and add alert when delta exceeds 10% baseline. Owner: DevOps.
- DOC-361: Expand parity runbook with troubleshooting tree and contact points; link to Story 3.6 artifacts. Owner: PM/QA.

## Risk-Based Testing Focus

- Priority 1: Validate streaming transcript integrity through Keploy proxy (AC2, AC3).
- Priority 2: Exercise CI record/test pipeline with failure injection to ensure rollback and fallback resilience (AC4, AC6).
- Priority 3: Confirm sanitization and documentation completeness (AC3, AC5).

## Monitoring Requirements

- Emit CI metrics for Keploy record/test stage duration, success rate, and flake counts.
- Alert when Keploy CLI version differs from pinned baseline in workflows.
- Log sanitization filter hits/misses to surface potential leakage.

## References

- Story: docs/bmad/stories/3.6.keploy-snapshot-ci-integration.md
- Issue: docs/bmad/issues/2025-09-19-keploy-snapshot-ci.md
- Architecture: docs/bmad/architecture/tech-stack.md#Testing & QA; docs/bmad/architecture/source-tree.md#Scripts & Ops
- Tooling: Keploy 3.x documentation (record/test workflow, proxy configuration)

**Hook:** `Risk profile: docs/bmad/qa/assessments/3.6-risk-20250919.md`
