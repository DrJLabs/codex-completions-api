---
title: Risk Profile — Story 3.5 (Golden Transcripts & Contract Checks)
story: docs/bmad/stories/3.5.golden-transcripts-contract-checks.md
date: 2025-09-19
reviewer: Quinn (Test Architect)
labels: [qa, risk, parity, streaming, contract-testing]
---

# Risk Profile: Story 3.5 — Golden Transcripts & Contract Checks

Date: 2025-09-19  
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 2 (TECH-301, TECH-302)
- Medium Risks: 2
- Low Risks: 2
- Overall Story Risk Score: Medium — success hinges on deterministic transcript capture and robust SSE contract automation.

## Risk Summary (Gate YAML)

```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 2
    low: 2
  highest:
    id: TECH-301
    score: 6
    title: Golden transcripts drift because Codex CLI output varies across runs or versions
  recommendations:
    must_fix:
      - Lock transcript capture behind deterministic prompts, fixed temperature, and recorded Codex CLI build metadata.
      - Add automated diff gating in CI so any transcript drift opens a blocking alert with contextual logs.
    monitor:
      - Track `npm run verify:all` duration trendlines to detect CI slowdowns from new contract checks.
      - Capture metrics on usage-chunk presence to ensure Codex CLI integration continues emitting expected payloads.
```

## Risk Register

| Risk ID  | Category    | Description                                                                                           | Prob | Impact | Score | Priority |
| -------- | ----------- | ----------------------------------------------------------------------------------------------------- | ---- | ------ | ----- | -------- |
| TECH-301 | Technical   | Golden transcripts drift because Codex CLI output varies across runs or upgrades despite fixtures     | 2    | 3      | 6     | High     |
| TECH-302 | Technical   | Playwright/Vitest contract suite misses ordering regressions or fails to assert usage chunk semantics | 2    | 3      | 6     | High     |
| OPS-301  | Operational | Fixture refresh workflow unclear, leading to stale transcripts that break CI or mask regressions      | 2    | 2      | 4     | Medium   |
| TEST-301 | Testing     | Playwright/Vitest contract suite introduces flakiness due to timing sensitivity or network setup      | 2    | 2      | 4     | Medium   |
| PERF-301 | Performance | Added contract suites push `npm run verify:all` beyond acceptable runtime budgets                     | 1    | 2      | 2     | Low      |
| DATA-301 | Data        | Transcripts inadvertently capture sensitive prompts or tokens during fixture generation               | 1    | 2      | 2     | Low      |

## Mitigations & Owners

- TECH-301: Capture transcripts with fixed temperature and seed, record `codex --version`, and enforce snapshot diffs in CI. Owner: Dev.
- TECH-302: Layer Playwright trace-based SSE specs with Vitest EventSource contract tests (powered by MSW 2) to cover ordering, reconnection, and usage semantics. Owner: Dev/QA.
- OPS-301: Document fixture refresh SOP (who, when, validation) inside story assets and parity docs; add checklist to PR template. Owner: PM/QA.
- TEST-301: Use MSW-based SSE mocks locally and run contract harness in headless Docker to remove network variability. Owner: QA.
- PERF-301: Measure and baseline CI runtime after suite landing; gate increases >10% with review. Owner: DevOps.
- DATA-301: Redact prompts to neutral content and ensure transcripts exclude secrets via automated sanitization script. Owner: Dev.

## Risk-Based Testing Focus

- Priority 1: Deterministic transcript capture regression (AC1) and SSE order/usage validation (AC3).
- Priority 2: Fixture refresh workflow rehearsal plus harness stability checks (AC1, AC3, AC4).
- Priority 3: CI runtime monitoring and transcript sanitization smoke (AC4).

## Monitoring Requirements

- Emit CI metric for transcript diff step duration and result (pass/fail) per branch.
- Dashboard `usage_chunk_present` ratio from contract tests to flag sudden drops.
- Alert when verify pipeline exceeds baseline by >10% for three consecutive runs.

## References

- Story: docs/bmad/stories/3.5.golden-transcripts-contract-checks.md
- Issue: docs/bmad/issues/2025-09-13-chat-golden-transcripts-contract-checks.md
- Research: Client--Library Compatibility Testing with API Interaction Snapshots (ICSME 2025)
- Architecture: docs/bmad/architecture/sequence-stream.md
- Tooling: Playwright Best Practices (updated 2025-08-20); MSW 2 SSE/WebSocket docs (2025)

**Hook:** `Risk profile: docs/bmad/qa/assessments/3.5-risk-20250919.md`
