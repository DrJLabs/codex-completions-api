---
title: NFR Assessment — Story 3.6 (Keploy Snapshot CI Integration)
story: docs/bmad/stories/3.6.keploy-snapshot-ci-integration.md
date: 2025-09-20
owner: QA (Quinn)
labels: [qa, nfr, keploy]
---

## Scope

Evaluate security, performance, reliability, and maintainability implications introduced by the Keploy-aware tooling and CI hooks delivered in Story 3.6.

## Summary

- **Security: PASS** — YAML fixtures sanitize dynamic identifiers and only reference fake credentials (`Bearer test-sk-ci`). No secrets added; docs stress sanitization during Keploy capture.
- **Performance: CONCERNS** — Replay step (`keploy test`) is gated behind `KEPLOY_ENABLED`; pipeline impact is unmeasured until CLI installation rolls out. Need empirical runtime budget and watchdog thresholds before enabling globally.
- **Reliability: CONCERNS** — Fallback path proven, but Keploy replay path remains unvalidated because runners lack the CLI. Risks include CI failures once flag flips without prior soak testing.
- **Maintainability: PASS** — Centralized helper (`tests/shared/keploy-runner.js`), explicit config (`config/keploy.yml`), and doc updates reduce onboarding friction. Conditional toggles keep local workflows simple.

Quality Score: 80 (two CONCERNS @ −10 each).

## Details & Recommendations

### Security (PASS)

- Authorization headers in snapshots use non-sensitive test keys.
- Sanitization mask ensures no dynamic IDs/timestamps leak.
- Recommendation: When real Codex transcripts are captured in future, extend `noise` rules to mask any provider-specific metadata.

### Performance (CONCERNS)

- Unknown runtime for `keploy test` on GitHub runners; additional process spawn plus proxy handshake could add >30s if not optimized.
- Recommendation: During installation rollout, record baseline timings and add CI alert when replay exceeds agreed budget (e.g., >60s).

### Reliability (CONCERNS)

- `runKeploySuite` throws if CLI missing; mitigated by keeping `KEPLOY_ENABLED=false` until installation completes.
- Recommendation: As part of rollout ticket, add canary job (nightly or feature branch) enabling Keploy to confirm stability before default-on.

### Maintainability (PASS)

- Single source of truth for config + helper reduces duplicate logic.
- Action: keep generator script documented; ensure rotation process includes YAML snapshots.

## Follow-up Actions

1. Execute rollout ticket `docs/bmad/issues/2025-09-20-keploy-install-config.md` to provision CLI and capture performance metrics.
2. Add monitoring note (CI log scraping or workflow summary) once Keploy enabled to track replay duration and exit codes.

## Decision

NFR Status: CONCERNS — Proceed with Story 3.6, but Keploy installation ticket must close before enabling the flag in CI to mitigate performance/reliability risk.

NFR assessment: docs/bmad/qa/assessments/3.6-nfr-20250920.md
