---
title: Requirements Traceability Matrix — Story 3.10 (Release & Backup Hardening)
story: docs/bmad/stories/3.10.release-backup-hardening.md
epic: docs/bmad/stories/epic-stability-ci-hardening-sep-2025.md
date: 2025-09-22
owner: QA (Quinn)
---

## Scope

Map Story 3.10 acceptance criteria to the implemented scripts, workflows, documentation, and validation evidence that enable lightweight release/backups for a solo maintainer.

## Matrix

- **AC1 — Snapshot tooling produces versioned tarball + metadata with keep-count pruning**
  - Evidence:
    - `scripts/stack-snapshot.sh` rewritten to stage sources via `rsync`, generate `<app>-v<version>-<timestamp>.tar.gz` and lock metadata with git SHA + checksum.
    - Supports `--keep`, `--prune`, and optional Docker retagging; tested via `bash scripts/stack-snapshot.sh --dry-run --keep 3 --prune` (2025-09-22 06:41Z) showing planned tarball/lock outputs.
  - Tests / Scenarios:
    - `npm run snapshot:dry-run`
  - Status: **FULL**.

- **AC2 — Release workflow builds once, verifies digest, and uploads to GitHub Release**
  - Evidence:
    - `.github/workflows/release.yml` tags `v*`, runs snapshot script, verifies `sha256sum`, updates lock `release_url`, and attaches tarball + lock + `SHA256SUMS`.
    - README + playbook document manual fallback (`gh release create ...`) and digest verification step.
  - Tests / Scenarios:
    - Workflow linted via Prettier/exempt; dry-run snapshot confirms metadata produced.
  - Status: **FULL** (workflow wired, ready to execute on next tag).

- **AC3 — Retention policy enforces keep-count locally**
  - Evidence:
    - Snapshot script `prune_artifacts()` removes tarballs/locks beyond `--keep` with dry-run previews.
    - Docs/runbook instruct enabling `--prune`; TL;DR updated in playbook.
  - Tests / Scenarios:
    - `bash scripts/stack-snapshot.sh --dry-run --keep 3 --prune` shows prune plan without deleting files.
  - Status: **FULL**.

- **AC4 — `.codex-api` backup procedure copies to Google Drive with checksum + optional encryption**
  - Evidence:
    - New `scripts/codex-data-backup.sh` handles mount health, tarball creation, GPG optional encryption, keep-count pruning.
    - Real run: `bash scripts/codex-data-backup.sh --mount-check --keep 3 --prune` stored `codex-api-2025-09-22T074218Z.tar.gz` and `.sha256` in `/mnt/gdrive/codex-backups/2025-09-22/`.
  - Tests / Scenarios:
    - Dry-run preview (`--dry-run --mount-check`) before full execution.
  - Status: **FULL**.

- **AC5 — Documentation updates cover workflow, retention, backup, and restore drills**
  - Evidence:
    - `docs/runbooks/stack-recovery.md` rewritten for tarball flow, Google Drive backups, restore cadence.
    - `docs/dev-to-prod-playbook.md` adds release bundle + backup steps in TL;DR and deep sections.
    - README “Release & Backup shortcuts” section directs maintainers to new scripts.
  - Tests / Scenarios:
    - Prettier formatting (`npm run format:check`).
  - Status: **FULL**.

## Given‑When‑Then Highlights

- **Given** a maintainer runs `npm run snapshot:dry-run`, **when** the script executes, **then** it reports the tarball/lock it would create along with prune actions, ensuring predictable outputs before touching disk.
- **Given** a tag `vX.Y.Z` is pushed, **when** the Release workflow runs, **then** it packages the tarball, verifies SHA256, and publishes assets to GitHub, keeping artifacts available beyond the default workflow retention window.
- **Given** Google Drive is mounted at `/mnt/gdrive`, **when** `bash scripts/codex-data-backup.sh --mount-check --keep 3 --prune` runs, **then** it creates a dated archive + checksum and prunes older backups, providing offsite redundancy.

## Coverage Summary

- Total Requirements: 5
- Fully Covered: 5 (100%)
- Partially Covered: 0 (0%)
- Not Covered: 0 (0%)

### Coverage Gaps

None.

## Recommendations

- Schedule the first tag-driven Release workflow run to collect end-to-end evidence (attach SHA digests to release notes).
- Automate monthly restore checklist updates to `docs/bmad/qa/artifacts/3.10/restore-checklist.md` as part of ongoing ops.

Trace matrix: docs/bmad/qa/assessments/3.10-trace-20250922.md
