---
title: Risk Profile — Story 3.7 (Keploy CLI Rollout & Enablement)
story: docs/bmad/stories/3.7.keploy-cli-rollout.md
date: 2025-09-21
reviewer: Quinn (Test Architect)
labels: [qa, risk, keploy, ci, tooling]
---

# Risk Profile: Story 3.7 — Keploy CLI Rollout & Enablement

Date: 2025-09-20  
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 6
- Critical Risks: 0
- High Risks: 2 (OPS-3701, SEC-3701)
- Medium Risks: 3
- Low Risks: 1
- Overall Story Risk Score: Medium — success depends on disciplined install automation, localhost-only exposure, and deterministic CI replay evidence; the 2025-09-21 keploy-dry-run run provides baseline telemetry for ongoing monitoring.

## Risk Summary (Gate YAML)

```yaml
risk_summary:
  totals:
    critical: 0
    high: 2
    medium: 3
    low: 1
  highest:
    id: OPS-3701
    score: 6
    title: CLI install or proxy bootstrap fails on runners lacking required ports or loopback bindings
  recommendations:
    must_fix:
      - Script installer pre-flight checks for 127.0.0.1 bindings and fail fast when ports 16789/16790/26789 are unavailable.
      - Provide rollback path to inline transcript recorder with documented toggle procedure.
    monitor:
      - Track Keploy CLI version drift and regenerate cached layer when upstream releases break compatibility.
      - Capture CI record/test runtime metrics so pipeline budget regressions surface quickly.
```

## Risk Register

| Risk ID   | Category      | Description                                                                                                        | Prob | Impact | Score | Priority |
| --------- | ------------- | ------------------------------------------------------------------------------------------------------------------ | ---- | ------ | ----- | -------- |
| OPS-3701  | Operational   | CLI installation or proxy bootstrap fails in CI/local environments when required ports or loopback bindings differ | 2    | 3      | 6     | High     |
| SEC-3701  | Security      | Ports exposed beyond localhost if Docker/Compose publish directives omit 127.0.0.1 binding                         | 2    | 3      | 6     | High     |
| TECH-3701 | Technical     | Keploy CLI/daemon version drift introduces incompatibility with existing `keploy.yml` settings or report schema    | 2    | 2      | 4     | Medium   |
| PERF-3701 | Performance   | Record/test stage extends `npm run verify:all` beyond target window without caching the CLI or artefacts           | 2    | 2      | 4     | Medium   |
| DATA-3701 | Data          | Snapshot storage lacks sanitisation enforcement during rollout, risking inclusion of bearer tokens or PII          | 1    | 3      | 3     | Medium   |
| DOC-3701  | Documentation | Onboarding docs omit loopback binding and troubleshooting guidance, slowing developer adoption                     | 1    | 2      | 2     | Low      |

## Mitigations & Owners

- OPS-3701: Embed install pre-flight script that validates port availability, honours Keploy’s fixed record/test port expectations, and confirms localhost binding (`127.0.0.1:HOST:CONTAINER` in Docker/Compose) before running `keploy run`. Owner: DevOps. citeturn0search0turn0search1turn0search6turn1search4turn2search0
- SEC-3701: Document loopback publish examples in `keploy-cli` rollout guides and add CI assertion that published ports resolve to loopback; fallback to internal Docker network when possible. Owner: QA/DevOps. citeturn0search0turn0search1turn0search6
- TECH-3701: Pin Keploy CLI version in installer helper, cache the binary layer, and add detection when upstream releases a newer major version. Owner: QA/DevOps. citeturn1search0turn2search4
- PERF-3701: Cache CLI installation, archive replay artefacts without storing sanitized payloads in caches, and benchmark record/test stage durations relative to baseline; alert on >10% regression. Owner: DevOps. citeturn0search4turn2search4turn1search6
- DATA-3701: Reuse sanitisation filters defined in Story 3.6 and add verification tests that Keploy reports redact auth headers before rollout. Owner: QA/Dev. citeturn2search0turn2search1
- DOC-3701: Update tech stack/test docs and `.env` samples with loopback binding, port override, and troubleshooting matrix for installers. Owner: PM/QA. citeturn1search2turn0search6turn0search1

## Risk-Based Testing Focus

- Priority 1: Install smoke that verifies loopback-only bindings and fails when ports appear on non-local interfaces.
- Priority 2: CI dry-run job executing `keploy test` with artefact upload to ensure deterministic replay under cached CLI layer.
- Priority 3: Snapshot sanitisation regression tests and documentation validation (checklist before enabling `KEPLOY_ENABLED=true`).

## Monitoring Requirements

- Emit CI metrics for Keploy install/record/test stage duration and failure counts.
- Detect CLI version drift vs pinned baseline; alert on mismatches.
- Log loopback binding verification results during pipeline execution.

## References

- Story: docs/bmad/stories/3.7.keploy-cli-rollout.md
- Issue: docs/bmad/issues/2025-09-20-keploy-install-config.md
- Architecture: docs/bmad/architecture/tech-stack.md#Testing & QA; docs/bmad/architecture/source-tree.md#Scripts & Ops
- Tooling: Keploy 3.x documentation (proxy ports, CLI install, Docker usage)

**Hook:** `Risk profile: docs/bmad/qa/assessments/3.7-risk-20250920.md`
