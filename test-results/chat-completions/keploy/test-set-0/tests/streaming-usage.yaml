version: api.keploy.io/v1beta1
kind: Http
name: streaming-usage
description: Chat completions snapshot for streaming-usage
created: 2025-09-20T07:50:37.846Z
spec:
  request:
    method: POST
    url: /v1/chat/completions?stream=true
    headers:
      Content-Type:
        - application/json
      Authorization:
        - Bearer test-sk-ci
    body: |-
      {
        "model": "codex-5",
        "stream": true,
        "stream_options": {
          "include_usage": true
        },
        "messages": [
          {
            "role": "user",
            "content": "Stream transcript"
          }
        ]
      }
  response:
    status_code: 200
    headers:
      Content-Type:
        - text/event-stream
    body: |-
      {
        "stream": [
          {
            "type": "data",
            "data": {
              "id": "<dynamic-id>",
              "object": "chat.completion.chunk",
              "created": "<timestamp>",
              "model": "codex-5",
              "choices": [
                {
                  "index": 0,
                  "delta": {
                    "role": "assistant"
                  },
                  "finish_reason": null
                }
              ],
              "usage": null
            }
          },
          {
            "type": "data",
            "data": {
              "id": "<dynamic-id>",
              "object": "chat.completion.chunk",
              "created": "<timestamp>",
              "model": "codex-5",
              "choices": [
                {
                  "index": 0,
                  "delta": {
                    "content": "Hello f"
                  },
                  "finish_reason": null
                }
              ],
              "usage": null
            }
          },
          {
            "type": "data",
            "data": {
              "id": "<dynamic-id>",
              "object": "chat.completion.chunk",
              "created": "<timestamp>",
              "model": "codex-5",
              "choices": [
                {
                  "index": 0,
                  "delta": {
                    "content": "rom fake-codex."
                  },
                  "finish_reason": null
                }
              ],
              "usage": null
            }
          },
          {
            "type": "data",
            "data": {
              "id": "<dynamic-id>",
              "object": "chat.completion.chunk",
              "created": "<timestamp>",
              "model": "codex-5",
              "choices": [
                {
                  "index": 0,
                  "delta": {},
                  "finish_reason": "stop"
                }
              ],
              "usage": null
            }
          },
          {
            "type": "data",
            "data": {
              "id": "<dynamic-id>",
              "object": "chat.completion.chunk",
              "created": "<timestamp>",
              "model": "codex-5",
              "choices": [],
              "usage": {
                "prompt_tokens": 8,
                "completion_tokens": 6,
                "total_tokens": 14,
                "time_to_first_token": null,
                "throughput_after_first_token": null,
                "emission_trigger": "token_count"
              }
            }
          },
          {
            "type": "done"
          }
        ]
      }
  noise:
    body:
      - path: $.stream[*].data.id
      - path: $.stream[*].data.created
metadata:
  codex_bin: scripts/fake-codex-proto.js
  commit: 153082581fe68c6a78213a1cc0deafcea95b0a63
  include_usage: true
  placeholders:
    id: <dynamic-id>
    created: <timestamp>
